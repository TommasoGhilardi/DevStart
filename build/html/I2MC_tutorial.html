

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="Using I2MC for Robust Fix Extraction" name="title" />
<meta content="Tommaso Ghilardi" name="author" />
<meta content="Learn how to use I2MC for robust fixation extraction in eye-tracking data analysis." name="description" />
<meta content="eye-tracking, I2MC, fixation detection, data analysis, tutorial, python, DevStart, developmental science, tutorial, eye fixations" name="keywords" />

    <title>Using I2MC for robust fix extraction &#8212; Dev Start: getting started with developmental science!!</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'I2MC_tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Introduction to eye-tracking" href="Intro_eyetracking.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="tree.html">
  
  
  
  
    
    
    
    <img src="_static/IconB.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/IconW.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Python.html">Starting with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="R.html">Starting with R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Creating an experiment:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Psychopy.html">Starting with PsychoPy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Eyetracking:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Intro_eyetracking.html">Introduction to eye-tracking</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Using I2MC for robust fix extraction</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/I2MC_tutorial.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using I2MC for robust fix extraction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-are-going-to-do">What we are going to do</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-i2mc">Install I2MC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-i2mc">Use I2MC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-data">Import data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-our-data">Find our data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-output-folder">Define the output folder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i2mc-settings">I2MC settings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-i2mc">Run I2MC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-are-done">WE ARE DONE!!!!!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entire-script">Entire script</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="using-i2mc-for-robust-fix-extraction">
<h1>Using I2MC for robust fix extraction<a class="headerlink" href="#using-i2mc-for-robust-fix-extraction" title="Permalink to this heading">#</a></h1>
<section id="what-we-are-going-to-do">
<h2>What we are going to do<a class="headerlink" href="#what-we-are-going-to-do" title="Permalink to this heading">#</a></h2>
<p>When it comes to eye-tracking data, one of the most important things we
want to figure out is fixations. Fixations are specific points in an
eye-tracking dataset where a person’s gaze remains relatively still and
focused on a particular area or object for a period of time. These
moments represent critical instances when a person’s visual attention is
focused on a particular point of interest.</p>
<p>Typically, eye-tracking programs come with their own fixation detection
algorithms that give us a rough idea of what the person was looking at.
But here’s the problem: these tools aren’t always very good when it
comes to data from infants and children. Why? Because infants and
children can be all over the place! They move their heads, put their
hands (or even feet) in front of their faces, close their eyes, or just
look away. All of this makes the data a big mess that’s hard to make
sense of with regular fixation detection algorithms. Because the data is
so messy, it is difficult to tell which data points are part of the same
fixation or different fixations.</p>
<p><strong>But don’t worry! We’ve got a solution: I2MC.</strong></p>
<p>I2MC stands for <em>“Identification by Two-Means Clustering”</em>, and it was
designed specifically for this kind of problem. It’s designed to deal
with all kinds of noise, and even periods of data loss. In this
tutorial, we’ll show you how to use I2MC to find fixations. We won’t get
into the nerdy stuff about how it works - this is all about the
practical side. If you’re curious about the science, you can read our
<a class="reference external" href="https://link.springer.com/article/10.3758/s13428-016-0822-1">I2MC
article</a>.</p>
<p>Now that we’ve introduced I2MC, let’s get our hands dirty and see how to
use it!</p>
</section>
<section id="install-i2mc">
<h2>Install I2MC<a class="headerlink" href="#install-i2mc" title="Permalink to this heading">#</a></h2>
<p>Installing I2MC in Python is extremely easy. As explained in the
tutorial to install Python, just open the miniconda terminal, activate
the environment you want to install I2MC in and type
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">I2MC</span></code>. After a few seconds, you should be ready to go!!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I2MC has been originally written for Matlab. So for you crazy people who would prefer to use Matlab you can find instructions to download and use I2MC here: <a class="reference external" href="https://github.com/royhessels/I2MC">I2MC Matlab!</a></p>
</div>
</section>
<section id="use-i2mc">
<h2>Use I2MC<a class="headerlink" href="#use-i2mc" title="Permalink to this heading">#</a></h2>
<p>Let’s start with importing the libraries that we will need</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">I2MC</span>                         <span class="c1"># I2MC</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                 <span class="c1"># panda help us read csv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                  <span class="c1"># to handle arrays</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>  <span class="k">as</span> <span class="nn">plt</span>    <span class="c1"># to make plots</span>
</pre></div>
</div>
<p>This was too easy now, let’s start to really get into it.</p>
<section id="import-data">
<h3>Import data<a class="headerlink" href="#import-data" title="Permalink to this heading">#</a></h3>
<p>Now we will write a simple function to import our data. This step
unfortunately will have to be adapted depending on the system you used
to collect the data and the data structure you will have in the end. For
this tutorial, you can use your dataset (probably you will have to adapt
the importing function) or use our data that you can download from here
LINK.</p>
<p>Let’s import our data</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">raw_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">PATH_TO_DATA</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>After reading the data we will create a new data-frame that we will fill
with the information needed from our raw_df. this is the point that
would change depending on you eye-tracked and data format. you will
probably have to change the columns names to be sure to have the 5
relevant ones.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create empty dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># Extract required data</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftX&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftY&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightX&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightY&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>After selecting the relevant data we will perform some very basic
processing. - Sometimes there could be weird peaks where one sample is
(very) far outside the monitor. Here, we will count as missing any data
that is more than one monitor distance outside the monitor. - Tobii
gives us the validity index of the measured eye, here when the validity
is too low (&gt;1) we will consider the sample as missing</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sometimes we have weird peaks where one sample is (very) far outside the</span>
<span class="c1"># monitor. Here, count as missing any data that is more than one monitor</span>
<span class="c1"># distance outside the monitor.</span>

<span class="c1"># Left eye</span>
<span class="n">lMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">lMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">lMiss</span>  <span class="o">=</span> <span class="n">lMiss1</span> <span class="o">|</span> <span class="n">lMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityLeft&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

<span class="c1"># Right eye</span>
<span class="n">rMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">rMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">rMiss</span>  <span class="o">=</span> <span class="n">rMiss1</span> <span class="o">|</span> <span class="n">rMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityRight&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
</pre></div>
</div>
<p><strong>Perfect!!!</strong></p>
<p>We have read the data, extracted the relevant information and done some
extremely basic processing rejecting data that had to be considered non
valid. Now we will wrap this code in a function to make it easier to use
with I2MC:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================================================================</span>
<span class="c1"># Import data from Tobii TX300</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">tobii_TX300</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="mi">1920</span><span class="p">,</span><span class="mi">1080</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Imports data from Tobii TX300</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : string</span>
<span class="sd">        The file (filepath)</span>
<span class="sd">    res : tuple</span>
<span class="sd">        The (X,Y) resolution of the screen</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">         Gaze data, with columns:</span>
<span class="sd">         t : The sample times from the dataset</span>
<span class="sd">         L_X : X positions from the left eye</span>
<span class="sd">         L_Y : Y positions from the left eye</span>
<span class="sd">         R_X : X positions from the right eye</span>
<span class="sd">         R_Y : Y positions from the right eye</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Load all data</span>
    <span class="n">raw_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Extract required data</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftX&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftY&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightX&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightY&#39;</span><span class="p">]</span>

    <span class="c1">###</span>
    <span class="c1"># Sometimes we have weird peaks where one sample is (very) far outside the</span>
    <span class="c1"># monitor. Here, count as missing any data that is more than one monitor</span>
    <span class="c1"># distance outside the monitor.</span>

    <span class="c1"># Left eye</span>
    <span class="n">lMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lMiss</span>  <span class="o">=</span> <span class="n">lMiss1</span> <span class="o">|</span> <span class="n">lMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityLeft&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

    <span class="c1"># Right eye</span>
    <span class="n">rMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rMiss</span>  <span class="o">=</span> <span class="n">rMiss1</span> <span class="o">|</span> <span class="n">rMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityRight&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

    <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="find-our-data">
<h3>Find our data<a class="headerlink" href="#find-our-data" title="Permalink to this heading">#</a></h3>
<p>Nice!! we have our import function that we will use to read our data.
Now, let’s find our data! To do this, we will use the glob library,
which is a handy tool for finding files in Python. In the code above,
we are telling Python to look for files with a <em>.csv</em> extension in a
specific folder on our computer. Let’s import glob and then let’s find
the files:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="n">data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">tomma</span><span class="se">\\</span><span class="s1">i2mc_tutorial</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">**</span><span class="se">\\</span><span class="s1">*.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>/home/geeks/Desktop/gfg/: This is the path where we want to start our
search.</p></li>
<li><p>**: This special symbol tells Python to search in all the
subfolders (folders within folders) under our starting path.</p></li>
<li><p>/*.csv: We’re asking Python to look for files with names ending in
“.csv”.</p></li>
<li><p>recursive=True: This option means that Python should search for files
not just in the immediate subfolders but in all the subfolders within
subfolders, and so on.</p></li>
</ul>
<p>So, when we run this code, Python will find and give us a list of all
the <em>.csv</em> files located in any subfolder within our specified path.
This makes it really convenient to find and work with lots of files at
once.</p>
</section>
<section id="define-the-output-folder">
<h3>Define the output folder<a class="headerlink" href="#define-the-output-folder" title="Permalink to this heading">#</a></h3>
<p>Before doing anything else I would suggest creating a folder where we
will save the output of I2MC. We will create a folder called
<em>i2mc_output</em>. Using the <em>os</em> library we make sure the output folder
doesn’t exist (<code class="docutils literal notranslate"><span class="pre">os.path.isdir(output_fodler)</span></code>) and then we create it
(<code class="docutils literal notranslate"><span class="pre">os.mkdir(output_fodler)</span></code>)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># define the output folder</span>
<span class="n">output_fodler</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">tomma</span><span class="se">\\</span><span class="s1">i2mc_tutorial</span><span class="se">\\</span><span class="s1">i2mc_output&#39;</span> <span class="c1"># define folder path\name</span>

<span class="c1"># Create the folder</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="i2mc-settings">
<h3>I2MC settings<a class="headerlink" href="#i2mc-settings" title="Permalink to this heading">#</a></h3>
<p>Now that we’ve got our data, know how to import it using glob and we
have out output folder, we’re all set to run I2MC. But wait, before we
dive in, we need to set up a few things. These settings are like the
instructions we give to I2MC before it does its magic. The default
settings usually work just fine for most situations. You can keep them
as they are and proceed. If you’re curious about what each of these
settings does, you can explore the original <a class="reference external" href="https://link.springer.com/article/10.3758/s13428-016-0822-1">I2MC
article</a>
for a detailed understanding. Here I’ve added a general explanation
about what each setting does. Once you’ve read through the instructions
and have a clear understanding, you can customize the settings to match
your specific requirements.</p>
<p>Let’s define these settings:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================================================================</span>
<span class="c1"># NECESSARY VARIABLES</span>
<span class="c1"># =============================================================================</span>
<span class="n">opt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># General variables for eye-tracking data</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">1920.0</span>                <span class="c1"># maximum value of horizontal resolution in pixels</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">1080.0</span>                <span class="c1"># maximum value of vertical resolution in pixels</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;missingx&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span>          <span class="c1"># missing value for horizontal position in eye-tracking data (example data uses -xres). used throughout the algorithm as signal for data loss</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;missingy&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]</span>          <span class="c1"># missing value for vertical position in eye-tracking data (example data uses -yres). used throughout algorithm as signal for data loss</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">300.0</span>                 <span class="c1"># sampling frequency of data (check that this value matches with values actually obtained from measurement!)</span>

<span class="c1"># Variables for the calculation of visual angle</span>
<span class="c1"># These values are used to calculate noise measures (RMS and BCEA) of</span>
<span class="c1"># fixations. The may be left as is, but don&#39;t use the noise measures then.</span>
<span class="c1"># If either or both are empty, the noise measures are provided in pixels</span>
<span class="c1"># instead of degrees.</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;scrSz&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="p">[</span><span class="mf">50.9174</span><span class="p">,</span> <span class="mf">28.6411</span><span class="p">]</span>    <span class="c1"># screen size in cm</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;disttoscreen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">65.0</span>                  <span class="c1"># distance to screen in cm.</span>

<span class="c1"># Options of example script</span>
<span class="n">do_plot_data</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># if set to True, plot of fixation detection for each trial will be saved as png-file in output folder.</span>
<span class="c1"># the figures works best for short trials (up to around 20 seconds)</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># OPTIONAL VARIABLES</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># The settings below may be used to adopt the default settings of the</span>
<span class="c1"># algorithm. Do this only if you know what you&#39;re doing.</span>

<span class="c1"># # STEFFEN INTERPOLATION</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;windowtimeInterp&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0.1</span>                           <span class="c1"># max duration (s) of missing values for interpolation to occur</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;edgeSampInterp&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mi">2</span>                             <span class="c1"># amount of data (number of samples) at edges needed for interpolation</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxdisp&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># maximum displacement during missing for interpolation to be possible</span>

<span class="c1"># # K-MEANS CLUSTERING</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;windowtime&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="mf">0.2</span>                           <span class="c1"># time window (s) over which to calculate 2-means clustering (choose value so that max. 1 saccade can occur)</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;steptime&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="mf">0.02</span>                          <span class="c1"># time window shift (s) for each iteration. Use zero for sample by sample processing</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxerrors&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mi">100</span>                           <span class="c1"># maximum number of errors allowed in k-means clustering procedure before proceeding to next file</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;downsamples&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;downsampFilter&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="kc">False</span>                         <span class="c1"># use chebychev filter when downsampling? Its what matlab&#39;s downsampling functions do, but could cause trouble (ringing) with the hard edges in eye-movement data</span>

<span class="c1"># # FIXATION DETERMINATION</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;cutoffstd&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mf">2.0</span>                           <span class="c1"># number of standard deviations above mean k-means weights will be used as fixation cutoff</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;onoffsetThresh&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">3.0</span>                           <span class="c1"># number of MAD away from median fixation duration. Will be used to walk forward at fixation starts and backward at fixation ends to refine their placement and stop algorithm from eating into saccades</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxMergeDist&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">30.0</span>                          <span class="c1"># maximum Euclidean distance in pixels between fixations for merging</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxMergeTime&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">30.0</span>                          <span class="c1"># maximum time in ms between fixations for merging</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;minFixDur&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mf">40.0</span>                          <span class="c1"># minimum fixation duration after merging, fixations with shorter duration are removed from output</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As mentioned above these setting should work for most scenarios including this example. However, depending on the population tested, and other factors you should modify the options accordingly. Please read the <a class="reference external" href="https://link.springer.com/article/10.3758/s13428-016-0822-1">I2MC article</a> where everything is explained !!!</p>
</div>
</section>
<section id="run-i2mc">
<h3>Run I2MC<a class="headerlink" href="#run-i2mc" title="Permalink to this heading">#</a></h3>
<p>Now we can finally run I2MC on all our files. To do so we will make for
loop that will iterate between all the files and: - create a folder for
each subject - import the data with the function created before - run
I2MC on the file - save the output file and the plot</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =============================================================================</span>
<span class="c1"># Run I2MC</span>
<span class="c1"># =============================================================================</span>

<span class="k">for</span> <span class="n">file_idx</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing file </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_files</span><span class="p">)))</span>

    <span class="c1"># Extract the name form the file path</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create the folder the specific subject</span>
    <span class="n">subj_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">):</span>
       <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">)</span>


    <span class="c1"># Import data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tobii_TX300</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="p">[</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">],</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]])</span>

    <span class="c1"># Run I2MC on the data</span>
    <span class="n">fix</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">I2MC</span><span class="o">.</span><span class="n">I2MC</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">opt</span><span class="p">)</span>

    <span class="c1">## Create a plot of the result and save them</span>
    <span class="k">if</span> <span class="n">do_plot_data</span><span class="p">:</span>
        <span class="c1"># pre-allocate name for saving file</span>
        <span class="n">save_plot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">I2MC</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">data_and_fixations</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fix</span><span class="p">,</span> <span class="n">fix_as_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">],</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]])</span>
        <span class="c1"># save figure and close</span>
        <span class="n">f</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_plot</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Write data to file after make it a dataframe</span>
    <span class="n">fix</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">fix_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fix</span><span class="p">)</span>
    <span class="n">save_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="n">fix_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_file</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="we-are-done">
<h2>WE ARE DONE!!!!!<a class="headerlink" href="#we-are-done" title="Permalink to this heading">#</a></h2>
<p>Congratulations on reaching this point! By now, you should have new
files containing valuable information from I2MC.</p>
<p>But what exactly does I2MC tell us?</p>
<p>I2MC provides us with a data frame that contains various pieces of
information:</p>
<p><strong>What I2MC Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cutoff</span></code>: A number representing the cutoff used for fixation
detection.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code>: An array holding the indices where fixations start.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code>: An array holding the indices where fixations end.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startT</span></code>: An array containing the times when fixations start.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">endT</span></code>: An array containing the times when fixations end.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dur</span></code>: An array storing the durations of fixations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xpos</span></code>: An array representing the median horizontal position for
each fixation in the trial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ypos</span></code>: An array representing the median vertical position for each
fixation in the trial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flankdataloss</span></code>: A boolean value (1 or 0) indicating whether a
fixation is flanked by data loss (1) or not (0).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fracinterped</span></code>: A fraction that tells us the amount of data loss or
interpolated data in the fixation data.</p></li>
</ul>
<p>In simple terms, I2MC helps us understand where and for how long a
person’s gaze remains fixed during an eye-tracking experiment. This is
just the first step. Now that we have our fixations, we’ll need to use
them to extract the information we’re interested in. Typically, this
involves using the raw data to understand what was happening at each
specific time point and using the data from I2MC to determine where the
participant was looking at that time. This will be covered in a new
tutorial. For now, you’ve successfully completed the preprocessing of
your eye-tracking data, extracting a robust estimation of participants’
fixations!!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p><strong>Caution</strong>: This tutorial is simplified and assumes the following:</p>
</div></blockquote>
<ul class="simple">
<li><p>Each participant has only one file (1 trial).</p></li>
<li><p>All files contain data.</p></li>
<li><p>The data is relatively clean (I2MC won’t throw any errors).</p></li>
<li><p>And so on.</p></li>
</ul>
<p>If your data doesn’t match these assumptions, you may need to modify the script to handle any discrepancies.</p>
<p>For a more comprehensive example and in-depth usage, check out the <a class="reference external" href="https://github.com/dcnieho/I2MC_Python/tree/master/example">I2MC repository</a>. It provides a more complete example with data checks for missing data and potential errors. Now that you’ve understood the basics here, interpreting that example should be much easier. If you encounter any issues while running the script, you can give that example a try or reach out to us via email!!!</p>
</div>
</section>
<section id="entire-script">
<h2>Entire script<a class="headerlink" href="#entire-script" title="Permalink to this heading">#</a></h2>
<p>To make it simple here is the entire script that we wrote together!!!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">I2MC</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>  <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># Import data from Tobii TX300</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">tobii_TX300</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="mi">1920</span><span class="p">,</span><span class="mi">1080</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Imports data from Tobii TX300</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : string</span>
<span class="sd">        The file (filepath)</span>
<span class="sd">    res : tuple</span>
<span class="sd">        The (X,Y) resolution of the screen</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">         Gaze data, with columns:</span>
<span class="sd">         t : The sample times from the dataset</span>
<span class="sd">         L_X : X positions from the left eye</span>
<span class="sd">         L_Y : Y positions from the left eye</span>
<span class="sd">         R_X : X positions from the right eye</span>
<span class="sd">         R_Y : Y positions from the right eye</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Load all data</span>
    <span class="n">raw_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Extract required data</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftX&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;LeftY&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightX&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;RightY&#39;</span><span class="p">]</span>

    <span class="c1">###</span>
    <span class="c1"># Sometimes we have weird peaks where one sample is (very) far outside the</span>
    <span class="c1"># monitor. Here, count as missing any data that is more than one monitor</span>
    <span class="c1"># distance outside the monitor.</span>

    <span class="c1"># Left eye</span>
    <span class="n">lMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">lMiss</span>  <span class="o">=</span> <span class="n">lMiss1</span> <span class="o">|</span> <span class="n">lMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityLeft&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lMiss</span><span class="p">,</span><span class="s1">&#39;L_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

    <span class="c1"># Right eye</span>
    <span class="n">rMiss1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rMiss2</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rMiss</span>  <span class="o">=</span> <span class="n">rMiss1</span> <span class="o">|</span> <span class="n">rMiss2</span> <span class="o">|</span> <span class="p">(</span><span class="n">raw_df</span><span class="p">[</span><span class="s1">&#39;ValidityRight&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rMiss</span><span class="p">,</span><span class="s1">&#39;R_Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NAN</span>

    <span class="k">return</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>



<span class="c1"># =============================================================================</span>
<span class="c1"># Preparation</span>
<span class="c1"># =============================================================================</span>

<span class="n">data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">tomma</span><span class="se">\\</span><span class="s1">surfdrive - Ghilardi, T. (Tommaso)@surfdrive.surf.nl</span><span class="se">\\</span><span class="s1">Documentation</span><span class="se">\\</span><span class="s1">Working</span><span class="se">\\</span><span class="s1">I2mc</span><span class="se">\\</span><span class="s1">data</span><span class="se">\\</span><span class="s1">**</span><span class="se">\\</span><span class="s1">*.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># define the output folder</span>
<span class="n">output_fodler</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">tomma</span><span class="se">\\</span><span class="s1">surfdrive - Ghilardi, T. (Tommaso)@surfdrive.surf.nl</span><span class="se">\\</span><span class="s1">Documentation</span><span class="se">\\</span><span class="s1">Working</span><span class="se">\\</span><span class="s1">I2mc</span><span class="se">\\</span><span class="s1">i2mc_output&#39;</span> <span class="c1"># define folder path\name</span>

<span class="c1"># Create the folder</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">):</span>
   <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">)</span>



<span class="c1"># =============================================================================</span>
<span class="c1"># NECESSARY VARIABLES</span>
<span class="c1"># =============================================================================</span>
<span class="n">opt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># General variables for eye-tracking data</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">1920.0</span>                <span class="c1"># maximum value of horizontal resolution in pixels</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">1080.0</span>                <span class="c1"># maximum value of vertical resolution in pixels</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;missingx&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span>          <span class="c1"># missing value for horizontal position in eye-tracking data (example data uses -xres). used throughout the algorithm as signal for data loss</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;missingy&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]</span>          <span class="c1"># missing value for vertical position in eye-tracking data (example data uses -yres). used throughout algorithm as signal for data loss</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">300.0</span>                 <span class="c1"># sampling frequency of data (check that this value matches with values actually obtained from measurement!)</span>

<span class="c1"># Variables for the calculation of visual angle</span>
<span class="c1"># These values are used to calculate noise measures (RMS and BCEA) of</span>
<span class="c1"># fixations. The may be left as is, but don&#39;t use the noise measures then.</span>
<span class="c1"># If either or both are empty, the noise measures are provided in pixels</span>
<span class="c1"># instead of degrees.</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;scrSz&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="p">[</span><span class="mf">50.9174</span><span class="p">,</span> <span class="mf">28.6411</span><span class="p">]</span>    <span class="c1"># screen size in cm</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;disttoscreen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">65.0</span>                  <span class="c1"># distance to screen in cm.</span>

<span class="c1"># Options of example script</span>
<span class="n">do_plot_data</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># if set to True, plot of fixation detection for each trial will be saved as png-file in output folder.</span>
<span class="c1"># the figures works best for short trials (up to around 20 seconds)</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># OPTIONAL VARIABLES</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># The settings below may be used to adopt the default settings of the</span>
<span class="c1"># algorithm. Do this only if you know what you&#39;re doing.</span>

<span class="c1"># # STEFFEN INTERPOLATION</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;windowtimeInterp&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0.1</span>                           <span class="c1"># max duration (s) of missing values for interpolation to occur</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;edgeSampInterp&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mi">2</span>                             <span class="c1"># amount of data (number of samples) at edges needed for interpolation</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxdisp&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># maximum displacement during missing for interpolation to be possible</span>

<span class="c1"># # K-MEANS CLUSTERING</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;windowtime&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="mf">0.2</span>                           <span class="c1"># time window (s) over which to calculate 2-means clustering (choose value so that max. 1 saccade can occur)</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;steptime&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="mf">0.02</span>                          <span class="c1"># time window shift (s) for each iteration. Use zero for sample by sample processing</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxerrors&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mi">100</span>                           <span class="c1"># maximum number of errors allowed in k-means clustering procedure before proceeding to next file</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;downsamples&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;downsampFilter&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="kc">False</span>                         <span class="c1"># use chebychev filter when downsampling? Its what matlab&#39;s downsampling functions do, but could cause trouble (ringing) with the hard edges in eye-movement data</span>

<span class="c1"># # FIXATION DETERMINATION</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;cutoffstd&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mf">2.0</span>                           <span class="c1"># number of standard deviations above mean k-means weights will be used as fixation cutoff</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;onoffsetThresh&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="mf">3.0</span>                           <span class="c1"># number of MAD away from median fixation duration. Will be used to walk forward at fixation starts and backward at fixation ends to refine their placement and stop algorithm from eating into saccades</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxMergeDist&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">30.0</span>                          <span class="c1"># maximum Euclidean distance in pixels between fixations for merging</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;maxMergeTime&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="mf">30.0</span>                          <span class="c1"># maximum time in ms between fixations for merging</span>
<span class="n">opt</span><span class="p">[</span><span class="s1">&#39;minFixDur&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="mf">40.0</span>                          <span class="c1"># minimum fixation duration after merging, fixations with shorter duration are removed from output</span>



<span class="c1"># =============================================================================</span>
<span class="c1"># Run I2MC</span>
<span class="c1"># =============================================================================</span>

<span class="k">for</span> <span class="n">file_idx</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_files</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing file </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_files</span><span class="p">)))</span>

    <span class="c1"># Extract the name form the file path</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Create the folder the specific subject</span>
    <span class="n">subj_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_fodler</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">):</span>
       <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">)</span>

    <span class="c1"># Import data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tobii_TX300</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="p">[</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">],</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]])</span>

    <span class="c1"># Run I2MC on the data</span>
    <span class="n">fix</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">I2MC</span><span class="o">.</span><span class="n">I2MC</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">opt</span><span class="p">)</span>

    <span class="c1">## Create a plot of the result and save them</span>
    <span class="k">if</span> <span class="n">do_plot_data</span><span class="p">:</span>
        <span class="c1"># pre-allocate name for saving file</span>
        <span class="n">save_plot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">I2MC</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">data_and_fixations</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fix</span><span class="p">,</span> <span class="n">fix_as_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="n">opt</span><span class="p">[</span><span class="s1">&#39;xres&#39;</span><span class="p">],</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;yres&#39;</span><span class="p">]])</span>
        <span class="c1"># save figure and close</span>
        <span class="n">f</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_plot</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Write data to file after make it a dataframe</span>
    <span class="n">fix</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">fix_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fix</span><span class="p">)</span>
    <span class="n">save_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subj_folder</span><span class="p">,</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="n">fix_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_file</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Intro_eyetracking.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction to eye-tracking</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-are-going-to-do">What we are going to do</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-i2mc">Install I2MC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-i2mc">Use I2MC</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-data">Import data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#find-our-data">Find our data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-output-folder">Define the output folder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#i2mc-settings">I2MC settings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-i2mc">Run I2MC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#we-are-done">WE ARE DONE!!!!!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#entire-script">Entire script</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tommaso Ghilardi & Francesco Poli & Giulia Serino
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022, Tommaso Ghilardi &amp; Francesco Poli &amp; Giulia Serino.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>